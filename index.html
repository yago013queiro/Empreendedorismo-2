<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MENTECH.AI ‚Äî Estudos & Programa√ß√£o</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- TODO o conte√∫do original do seu site permanece id√™ntico -->

  <!-- CHAT -->
  <section class="page" id="page-chat" data-page="chat">
    <div class="chat-wrap large">
      <header class="chat-top">
        <div class="chat-title">
          <div class="avatar">ü§ñ</div>
          <div>
            <h3>MAINTECH.AI</h3>
            <small class="chat-sub">Assistente de Estudos</small>
          </div>
        </div>

        <div class="chat-info">
          <div class="chip">√Årea: <span id="chip-area">‚Äî</span></div>
          <div class="chip">Linguagem: <span id="chip-lang">‚Äî</span></div>
          <div class="chip">N√≠vel: <span id="chip-level">‚Äî</span></div>
        </div>
      </header>

      <!-- deixamos o chat-box vazio -->
      <div class="chat-box" id="chat-box"></div>

      <div class="chat-input">
        <input id="user-input" placeholder="Digite sua pergunta..." autocomplete="off">
        <button id="send-btn">Enviar</button>
      </div>

      <div class="chat-actions">
        <button class="btn outline" onclick="goToPage('page-escolha')">Escolher novamente</button>
        <button class="btn danger" onclick="clearChat()">Limpar chat</button>
      </div>
    </div>
  </section>

  <footer class="site-footer">
    <small>¬© 2025 MENTECH.AI ‚Äî  Equipe 1¬∞ Informatica</small>
  </footer>

  <!-- IMPORTA O ARQUIVO AI.JS -->
  <script src="ai.js"></script>

  <!-- SCRIPT PRINCIPAL -->
  <script>
  /* ======== Estado e dados ======== */
  const state = { area: null, linguagem: null, nivel: null };

  function goToPage(id){
    document.querySelectorAll('.page').forEach(p=>{
      p.classList.remove('active');
      if(p.id===id) p.classList.add('active');
    });
    updateChips();
    window.scrollTo({ top:0, behavior:'smooth' });
    if(id==='page-chat') startChatIntro();
  }

  function setArea(a){ state.area=a; updateChips(); }
  function setLinguagem(l){ state.linguagem=l; updateChips(); }
  function setNivel(n){ state.nivel=n; updateChips(); }

  function updateChips(){
    document.getElementById('chip-area').textContent = state.area || '‚Äî';
    document.getElementById('chip-lang').textContent = state.linguagem || '‚Äî';
    document.getElementById('chip-level').textContent = state.nivel || '‚Äî';
  }

  /* ======== CHAT ======== */
  const chatBox = document.getElementById('chat-box');
  const input = document.getElementById('user-input');
  const sendBtn = document.getElementById('send-btn');

  function addMessage(text, who='ai'){
    const wrapper = document.createElement('div');
    wrapper.className = 'message ' + who;
    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    bubble.innerHTML = '<p>' + text.replace(/\n/g,'<br>') + '</p>';
    if(who==='ai'){
      wrapper.innerHTML = '<div class="avatar-mini">ü§ñ</div>';
      wrapper.appendChild(bubble);
    } else wrapper.appendChild(bubble);
    chatBox.appendChild(wrapper);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function simulateTyping(callback,time=900){
    const t=document.createElement('div');
    t.className='typing';
    t.textContent='Digitando...';
    chatBox.appendChild(t);
    chatBox.scrollTop=chatBox.scrollHeight;
    setTimeout(()=>{t.remove();callback();},time);
  }

  // IA REAL
  async function sendMessage(){
    const txt = input.value.trim();
    if(!txt) return;
    addMessage(txt,'user');
    input.value = '';
    simulateTyping(async ()=>{
      const resp = await askGemini(txt);
      if(!resp) addMessage("‚ùå N√£o consegui conectar √† IA. Tente novamente mais tarde.", 'ai');
      else addMessage(resp, 'ai');
    }, 1200);
  }

  // Mensagem inicial (checando se IA responde)
  async function startChatIntro(){
    if(!chatBox) return;
    if(chatBox.children.length < 1){
      simulateTyping(async ()=>{
        const ok = await checkIAStatus();
        if(ok) addMessage("Ol√°! Falaremos sobre o qu√™ hoje?", "ai");
        else addMessage("‚ö†Ô∏è A IA parece estar offline no momento. Tente novamente mais tarde.", "ai");
      }, 1000);
    }
  }

  function clearChat(){
    chatBox.innerHTML='';
    startChatIntro();
  }

  function prepareChat(){
    if(!state.area){ alert('Escolha antes a √°rea.'); goToPage('page-escolha'); return; }
    if(state.area==='programacao' && !state.linguagem){ alert('Escolha a linguagem.'); goToPage('page-programacao'); return; }
    if(!state.nivel){ goToPage('page-nivel'); return; }
    goToPage('page-chat');
  }

  /* ======== Controles ======== */
  document.addEventListener('DOMContentLoaded',()=>{
    document.getElementById('brand-logo')?.addEventListener('click',()=>goToPage('page-home'));
    document.getElementById('send-btn')?.addEventListener('click',sendMessage);
    document.getElementById('user-input')?.addEventListener('keypress',e=>{ if(e.key==='Enter') sendMessage(); });
    updateChips();
  });
  </script>
</body>
</html>
